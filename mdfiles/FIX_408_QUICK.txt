â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš¨ Ğ¡Ğ ĞĞ§ĞĞ: Ğ˜Ğ¡ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ• 408 TIMEOUT (Connection reset)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ĞŸĞ ĞĞ‘Ğ›Ğ•ĞœĞ: POST /api/upload HTTP/2.0" 408 0
          readv() failed (104: Connection reset by peer)

ĞŸĞ Ğ˜Ğ§Ğ˜ĞĞ: ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ñ‹Ğµ Ñ‚Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚Ñ‹ (300s) + Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²Ğ¸Ğµ HTTP/2 Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞº

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Ğ§Ğ¢Ğ Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ:

1. Ğ’ÑĞµ Ñ‚Ğ°Ğ¹Ğ¼Ğ°ÑƒÑ‚Ñ‹: 300s â†’ 600s (10 Ğ¼Ğ¸Ğ½ÑƒÑ‚)
2. Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹ HTTP/2 Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ (â­ ĞšĞ›Ğ®Ğ§Ğ•Ğ’ĞĞ•!):
   - http2_recv_timeout 600s
   - http2_max_field_size 64k
   - http2_max_header_size 128k
   - http2_body_preread_size 128k

3. Next.js API: maxDuration 300 â†’ 600

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš€ Ğ‘Ğ«Ğ¡Ğ¢Ğ ĞĞ• ĞŸĞ Ğ˜ĞœĞ•ĞĞ•ĞĞ˜Ğ•:

1. NGINX (Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾!)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   sudo cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.backup_408
   
   # Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚Ğµ Ğ½Ğ¾Ğ²Ñ‹Ğ¹ nginx.conf Ğ½Ğ° ÑĞµÑ€Ğ²ĞµÑ€
   # Ğ˜Ğ»Ğ¸ ÑĞºĞ¾Ğ¿Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ Ğ² Docker:
   docker cp nginx.conf nginx_container:/etc/nginx/nginx.conf
   
   # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°:
   sudo nginx -t
   # Ğ˜Ğ›Ğ˜
   docker exec nginx_container nginx -t
   
   # ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ:
   sudo systemctl reload nginx
   # Ğ˜Ğ›Ğ˜
   docker restart nginx_container

2. NEXT.JS (Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´ÑƒĞµÑ‚ÑÑ)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   cd web
   npm run build
   
   # Ğ—Ğ°Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¹Ñ‚Ğµ (Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ñ‚ Ğ¾Ñ‚ setup):
   docker-compose up -d --build
   # Ğ˜Ğ›Ğ˜
   pm2 restart kinosite

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ” ĞšĞ›Ğ®Ğ§Ğ•Ğ’Ğ«Ğ• Ğ˜Ğ—ĞœĞ•ĞĞ•ĞĞ˜Ğ¯ Ğ’ NGINX.CONF:

Ğ’ ÑĞµĞºÑ†Ğ¸Ğ¸ http (Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½Ğ¾):
  + http2_recv_timeout 600s;        â­â­â­ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ!
  + send_timeout 600s;
  + keepalive_timeout 600;
  + http2_max_field_size 64k;
  + http2_max_header_size 128k;
  
Ğ’ ÑĞµĞºÑ†Ğ¸Ğ¸ server:
  + http2_recv_timeout 600s;        â­â­â­ ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§ĞĞ!
  + send_timeout 600s;
  + keepalive_timeout 600;
  
Ğ’ location /api/upload:
  + send_timeout 600s;
  + proxy_buffering off;
  + proxy_buffer_size 128k;
  + proxy_buffers 8 128k;

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… Ğ¢Ğ•Ğ¡Ğ¢ ĞŸĞĞ¡Ğ›Ğ• ĞŸĞ Ğ˜ĞœĞ•ĞĞ•ĞĞ˜Ğ¯:

1. ĞÑ‚ĞºÑ€Ğ¾Ğ¹Ñ‚Ğµ: https://zabkinokom.ru/admin/site
2. Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚Ğµ Ğ²Ğ¸Ğ´ĞµĞ¾ 650MB
3. Ğ–Ğ´Ğ¸Ñ‚Ğµ 5-10 Ğ¼Ğ¸Ğ½ÑƒÑ‚
4. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑŒÑ‚Ğµ Ğ»Ğ¾Ğ³Ğ¸:
   
   docker logs -f nginx_container
   
   Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ:
   POST /api/upload HTTP/2.0" 200 âœ…  (Ğ²Ğ¼ĞµÑÑ‚Ğ¾ 408 âŒ)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ†˜ ĞĞ¢ĞšĞĞ¢ (ĞµÑĞ»Ğ¸ Ñ‡Ñ‚Ğ¾-Ñ‚Ğ¾ Ğ¿Ğ¾ÑˆĞ»Ğ¾ Ğ½Ğµ Ñ‚Ğ°Ğº):

sudo cp /etc/nginx/nginx.conf.backup_408 /etc/nginx/nginx.conf
sudo systemctl reload nginx

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“„ Ğ¤ĞĞ™Ğ›Ğ«:
  nginx.conf                  - Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³
  URGENT_FIX_408_TIMEOUT.md   - Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ
  
Ğ”ĞĞ¢Ğ: 2025-10-16
Ğ¡Ğ¢ĞĞ¢Ğ£Ğ¡: âœ… Ğ“ĞĞ¢ĞĞ’Ğ Ğš ĞŸĞ Ğ˜ĞœĞ•ĞĞ•ĞĞ˜Ğ®

