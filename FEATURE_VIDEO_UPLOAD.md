# Функциональность загрузки видео файлов

## Обзор изменений

Добавлена возможность загружать видео файлы напрямую в админ-панели для секции "О регионе" (hero section) на главной странице, в дополнение к существующей возможности использования внешних ссылок (Rutube, VK, YouTube).

## Что было сделано

### 1. Обновление базы данных

**Файл:** `web/prisma/schema.prisma`
- Добавлено новое поле `regionVideoFile` типа `String?` в модель `SiteContent`
- Создана миграция: `20251014063159_add_region_video_file`

### 2. Создан компонент VideoUploader

**Файл:** `web/src/components/VideoUploader.tsx`
- Новый React компонент для загрузки видео файлов
- Поддерживает форматы: MP4, WebM, OGG, MOV
- Показывает превью загруженного видео
- Использует существующий API `/api/upload` для загрузки файлов
- Цветовые темы: blue, purple, indigo, teal

### 3. Обновлена админ-панель

**Файл:** `web/src/app/admin/site/page.tsx`
- Добавлен VideoUploader компонент
- Реализована логика приоритета: файл > URL
- Добавлен разделитель "ИЛИ" между опциями загрузки
- Добавлена информационная подсказка о приоритете отображения
- Обновлена server action для сохранения пути к видео файлу

### 4. Обновлен фронтенд (главная страница)

**Файл:** `web/src/app/HomeClient.tsx`
- Обновлён интерфейс `SiteContent` с полем `regionVideoFile`
- Обновлена функция `RegionVideo` для поддержки обоих вариантов:
  - Загруженный файл (HTML5 video элемент с controls)
  - Внешняя ссылка (iframe embed)
- Приоритет отображения: если есть `regionVideoFile`, используется он, иначе `regionVideoUrl`

**Файл:** `web/src/app/page.tsx`
- Добавлена конвертация `regionVideoFile` из `null` в `undefined` для совместимости типов

## Как использовать

### В админ-панели

1. Перейдите в **Админ → Редактор контента**
2. Прокрутите до секции **"О регионе (видео)"**
3. Заполните заголовок и описание региона
4. Выберите один из вариантов:

   **Вариант 1: Загрузить видео файл**
   - Нажмите кнопку "Выбрать видео файл"
   - Выберите видео (MP4, WebM, OGG, MOV)
   - Файл автоматически загрузится и появится превью

   **Вариант 2: Использовать внешнюю ссылку**
   - Вставьте URL видео из Rutube, VK или YouTube
   - Поддерживаются как обычные, так и embed-ссылки

5. Нажмите "Сохранить изменения"

### Приоритет отображения

- Если загружен **видео файл**, он будет использован
- Если файла нет, будет использована **внешняя ссылка**
- Если ничего не указано, секция не отобразится

## Отличия в отображении

### Загруженный видео файл
- HTML5 `<video>` элемент
- Встроенные браузерные controls
- Автоматическое определение типа видео
- Атрибут `controlsList="nodownload"` (защита от скачивания)
- Атрибут `playsInline` для мобильных устройств

### Внешняя ссылка (iframe)
- Iframe embed от видеохостинга
- Нативные controls платформы (Rutube/VK/YouTube)
- Автоконвертация обычных URL в embed формат

## Технические детали

### API для загрузки
- Endpoint: `/api/upload`
- Method: POST
- FormData с файлом
- Сохранение в `/public/uploads/`
- Возврат URL файла

### Поддерживаемые форматы видео
- MP4 (video/mp4)
- WebM (video/webm)
- OGG (video/ogg)
- MOV (video/quicktime)

### Рекомендации
- Размер видео: до 100MB
- Разрешение: 1920x1080 (Full HD) или меньше
- Кодек: H.264 для лучшей совместимости

## Миграция существующих данных

Существующие внешние ссылки продолжат работать без изменений. Новое поле `regionVideoFile` по умолчанию пустое (`null`).

## Проверка функциональности

1. ✅ База данных обновлена (миграция применена)
2. ✅ Компонент VideoUploader создан
3. ✅ Админ-панель обновлена
4. ✅ Фронтенд обновлён
5. ✅ TypeScript типы корректны
6. ✅ Build проходит успешно
7. ✅ Нет linter ошибок

